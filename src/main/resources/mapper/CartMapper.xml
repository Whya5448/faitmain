<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
					
<mapper namespace="com.faitmain.domain.product.mapper.CartMapper">

	<resultMap id="cartSelectMap" type="com.faitmain.domain.product.domain.Cart">
		<result property="cartNumber" 		column="cart_number" 		jdbcType="INTEGER"/>
		<result property="userId"			column="user_id" 			jdbcType="VARCHAR" />
		<result property="cartQuantity" 	column="cart_quantity" 		jdbcType="INTEGER" />
		
		<association property="cartProduct"  javaType="com.faitmain.domain.product.domain.Product">
			<id property="productNumber" column="product_number" jdbcType="INTEGER"/>
			<result property="productName"			column="product_name" 			jdbcType="VARCHAR" />
			<result property="price" 				column="product_price" 			jdbcType="INTEGER" />
			<result property="productMainImage" 	column="product_main_image" 	jdbcType="VARCHAR" />
		</association>		
		
	</resultMap>


	
	<!-- 장바구니 추가 -->
	<insert id="addCart" parameterType="com.faitmain.domain.product.domain.Cart">		
		INSERT
		INTO cart(user_id, cart_quantity, product_number, product_name, product_price, product_main_image)
		VALUES (#{userId}, #{cartQuantity}, #{cartProduct.productNumber}, #{cartProduct.productName}, #{cartProduct.price}, #{cartProduct.productMainImage})
	</insert>	
	
	<select id="getCart"  parameterType="com.faitmain.domain.product.domain.Cart"	resultMap="cartSelectMap">
		SELECT * FROM cart 
		WHERE user_id = #{userId} AND product_number = #{cartProduct.productNumber};
	</select>
			
	<!-- 장바구니 목록 조회 -->
	<select  id="getCartList"  parameterType="com.faitmain.global.common.Search"	resultMap="cartSelectMap">
	  	SELECT *
	  	FROM (	SELECT inner_table.* , @ROWNUM := @ROWNUM+1 AS row_seq
	  			FROM		(	SELECT *
								FROM cart
								<where>
									user_id = #{searchKeyword}
								</where>
						ORDER BY cart_number DESC ) inner_table
				WHERE (@ROWNUM:=0)=0 limit #{endRowNum} ) result_table
		WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum} 
	 </select>
	 
	 <!-- SQL : SELECT ROW Count (현재 search 없음) -->	 
	<select  id="getTotalCount"  parameterType="com.faitmain.global.common.Search"	 resultType="int">
	  	SELECT COUNT(*)
	  	FROM(	SELECT *
				FROM cart
				<where>
					user_id = #{searchKeyword}
				</where>
			) countTable						
	 </select> 
		
	<!-- 장바구니 수정 -->	
	<update id="updateCart" parameterType="com.faitmain.domain.product.domain.Cart" >
		UPDATE cart
		<set>
			cart_quantity = #{cartQuantity}
		</set>
		WHERE cart_number = #{cartNumber}
	</update>
	
	<!-- 장바구니 삭제 -->
	<delete id="deleteCart" parameterType="int">
    	DELETE FROM cart WHERE cart_number = #{cartNumber}
  	</delete>
  	
</mapper>