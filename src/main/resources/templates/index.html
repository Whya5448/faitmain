<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
				layout:decorate = "~{layout/default_layout}"
      			xmlns:layout = "http://www.ultraq.net.nz/thymeleaf/layout">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <meta property="og:type" content="website" />
    	<meta property="og:title" content="바로 이용하는 무료 채팅 솔루션" />
    	<meta property="og:description" content="설치 없이 가입 즉시 바로 이용할 수 있는 무료 채팅 서비스를 제공 해 드리겠습니다." />
    	<meta property="og:image" content="https://www.vchatcloud.com/img/common/og_img.png" />
    	<meta property="og:url" content="https://www.vchatcloud.com" />
    	
        <title>Modern Business - Start Bootstrap Template</title>
		
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" th:href="@{img/favicon.ico}" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link th:href="@{css/styles.css}" rel="stylesheet" />
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
       	
       	<!-- live -->

       	<script th:src="@{js/vchatcloud-1.2.0.min.js}"></script> 

		<script th:src="@{js/like.js}"></script>
    	<script th:src="@{js/draw.js}"></script>
    	<script th:src="@{js/errMsg.js}"></script>
		
		<link rel="preconnect" href="https://fonts.gstatic.com">
    	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    	<script src="https://kit.fontawesome.com/c13f14f04a.js" crossorigin="anonymous"></script>
    	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    	<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.0/dist/sockjs.min.js"></script>
		
    </head>
    <body>
    
    <article layout:fragment="content" style="padding-top : 0px" >
            <!-- Header-->
            <header class="bg-dark" style="padding-top : 0px">
                <div class="container-fluid">
                    <div class="row align-items-center justify-content-center">
	                  	<div class="col-md-3 text-center" style="width: 424px">
	                  		<a class="btn btn-outline-light btn-lg" th:href="@{live/getLiveReservationCal}">
	                  			프리미엄 라이브<br/>
	                  			예약 확인
	                  		</a>
	                  	</div>


	                  	
                        <div id="remote_cam" class="col-md-3 text-center" style="height: 600px; width:400px">
                        </div>
                    	
                    	
                    	<div class="col-md-3 text-center" style="overflow:auto; height:500px; width: 424px;">
	                  		<h5 style="color : white">오늘 예약 목록</h5>
	                  	</div>
                    </div>
                </div>
            </header>
           
            <div class="container">
            
             <!-- LiveList section-->
	            <section class="py-5" id="features">
	            	<p class="px-10">Live List</p>
	                <div class="row px-5">
						<div class="col-md-12">
							<div class="row">
							
								<div class="col-md-3 pb-3" th:each="live : ${map.liveList}">
									<div class="card" style="height : 530px">
										<a th:href="@{'live/watchLive/' + ${live.liveNumber}}"><img class="card-img-top" alt="Bootstrap Thumbnail First" src="https://dummyimage.com/235x400/343a40/6c757d" style="height : 400px"></a>
											
										</img>
										<div class="card-block">
											<h5 th:text="${live.liveTitle}" class="card-title pt-3 pb-2 px-2">
												Live Title
											</h5>
											 	<h6 th:text="${live.liveIntro}" class="card-text px-2">Intro</h6>
											
										</div>
									</div>
								</div>
								
							</div>
						</div>
					</div>
	            </section>
	             <!-- ProductList section-->
	            <section class="py-5" id="features">
	            	<p class="px-10">Product List</p>
	                <div class="row px-5">
						<div class="col-md-12">
							<div class="row">
							
								<div class="col-md-3 pb-3" th:each="product : ${map.list}">
									<div class="card" style="position : relative; height : 530px">
										<img class="card-img-top" alt="Bootstrap Thumbnail First" src="https://dummyimage.com/235x400/343a40/6c757d" style="height : 400px"/>
										<div class="card-block" >
											<h5 th:text="${product.productName}" class="card-title pt-3 pb-2 px-2">
												Product Name
											</h5>
												<div style="position : absolute; right: 7px; bottom: 7px">
													<h6 class="pl-2" style="display : inline" >가격 : </h6><h6 th:text="${product.productPrice}" class="card-text" style="display : inline">Price</h6>
												</div>
											
										</div>
									</div>
								</div>
								
							</div>
						</div>
					</div>
	            </section>


            </div>
		</article>
    </body>
    <script th:inline="javascript">
    
    var channelKey = "hQcjeGhzpA-pFgyFa8lUs-20220613152322";
    
    function videoInit() {
			
    	channel.on("rtcRemoteStreamRemove", function(event){
    		console.log("rtcRemoteStreamRemove 발동");
    		let html=$('#remote_cam > video');
    		html.remove();
    	});
    	
    	  // 로컬 접속 시
    	channel.on("rtcRemoteStreamAppend", function (event) {
    	     	
    	   	remoteVideo = document.createElement("video");
    	    let stream = event.target;
    	    remoteVideo.srcObject = stream;
    	    remoteVideo.setAttribute("autoplay", true);
    	    remoteCam.append(remoteVideo);
    	    channel.setRTCRemoteMedia(remoteVideo);
    		    
    	    console.log('videoInit clear');
    	 });
    }

    	// 공통 코드 =====================================
		vChatCloud = new VChatCloud();
		
    	let channel, // joinRoom() 내부에서 채널 객체를 저장할 곳
    	  userNick = "hello", // 접속자의 닉네임, 사용자에게 입력받은 값을 사용해도 된다.
    	  userKey; // 접속자 고유 키
    	 


    	// rtc
    	let myCam;

    	window.addEventListener("load", function (){
    	  	// 접속자의 미디어 소스를 보여줄 위치
    	  
    	  	console.log('addEventListener start');
    	  	
    	  	remoteCam = $('#remote_cam');
    	  	remoteCam.attr('name', 'remote_cam');

    		
    		
    	    joinRoom(channelKey,  'xxxxxxxx'.replace(/[xy]/g, function(a, b) { return (b = Math.random() * 16, (a == 'y' ? b & 3 | 8 : b | 0).toString(16)) }), userNick, function(err, history){
    	    	if(err){
    	    		openError(err.code, function(){
    	    			vChatCloud.disconnect();
    	    		});
    	    		console.log('joinRoom clear');
    	    		
    	    	}else{
    	    		videoInit();
    	    		//채팅영역에 글쓰기가 활성화될시 활성화(최신공지 한개만 남기기)
    	    		let flag = undefined;
    	    		if(typeof write == 'function') history && history.forEach(function(m){
    	    			if(m.messageType == 'notice'){
    	    				if(flag == undefined){
    	    					flag = true;
    	    					write(m, 'notice', 'history');
    	    				}
    	    			}else{
    	    				write(m, '', 'history');
    	    			}
    	    		});
    	    		
    	    		//이벤트 바인딩 시작
    	    		getRoomInfo();
    		
    	    	};
    	   		
    		});
    		
    	});

    	function joinRoom(roomId, clientKey, nickName, callback) {
    	  // vchatcloud 객체
    	  console.log("clientKey : " + clientKey);
    	  channel = vChatCloud.joinChannel(
    	    {
    	      roomId: roomId,
    	      clientKey: clientKey,
    	      nickName: nickName
    	    },
    	    function (error, history) {
    	      $('div#content1 p').remove();
    	      if (error) {
    	        if (callback) return callback(error, null);
    	        return error;
    	      }
    	      if (callback) callback(null, history);
    	      // 채팅영역에 글쓰기가 활성화될시 활성화
    	    }
    	  );
    	}


    	function getRoomInfo() {
    	  const api_url = "https://vchatcloud.com/api/openapi/getChatRoomInfo";
    	  let param = {
    	    room_id: channelKey
    	  };
    	  $.post(
    	    api_url,
    	    param,
    	    function (data) {
    	      if (data.result_cd == 1) {
    	        console.log(data);
    	        // $("#roomNm").append(data.param.room_nm);
    	      } else {
    	        console.log("조회 실패");
    	        oastPopup("조회 실패");
    	      }
    	    },
    	    "json"
    	  );
    	}
    </script>
    
</html>
