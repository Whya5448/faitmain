<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.faitmain.domain.order.mapper.OrderMapper">

    <!-- 주문자 주소 정보 -->
    <select id="getBuyerInfo" resultType="User">
        SELECT user_number, name, address, total_point
          FROM user
         WHERE user_number = #{userNumber}
    </select>

    <!-- 주문 테이블 등록 -->
    <insert id="enrollOrder">

    </insert>

    <!-- 주문 상품 테이블 등록 -->
    <insert id="enrollOrderProduct">

    </insert>

    <!-- 주문 금액 차감 -->
    <update id="deductPoint">
        UPDATE user
           SET total_point = #{totalPoint}
         WHERE user_number = #{userNumber}
    </update>

    <!-- 주문 재고 차감 -->
    <update id="deductStock">
        UPDATE product
           SET product_quantity = #{productQuantity}
         WHERE product_number = #{productNumber}
    </update>

    <!-- 주문 상품 정보 (주문 페이지) -->
    <select id="getProductInfo" resultType="com.faitmain.domain.order.domain.OrderPageProduct">
        SELECT product_number, product_name, product_price
          FROM product
         WHERE product_number = #{productNumber};
    </select>

    <!--  주문 상품 정보 (주문 처리) -->
    <select id="getOrderInfo" resultType="com.faitmain.domain.order.domain.OrderProduct">
        SELECT product_number, product_price
          FROM product
         WHERE product_number = #{productNumber};
    </select>

    <!-- 주문 리스트 -->
    <select id="getOrderList" resultType="com.vam.model.OrderDTO">

        select order_number, buyer_id, order_status, order_date
        from `order`
        <if test="keyword != null">
            where `order`.buyer_id like concat('%',#{keyword}, '%')
        </if>
        order by order_date desc
        limit #{skip}, #{amount}

    </select>

    <!-- 상품 총 개수 -->
    <select id="getOrderTotal" resultType="int">

        select count(*) from `order`

        <if test="keyword != null">
            where `order`.buyer_id like concat('%',#{keyword}, '%')
        </if>

    </select>

    <!-- 주문취소 -->
    <update id="orderCancle">
        UPDATE `order`
           SET order_status = '주문취소'
         WHERE order_number = #{orderId}
    </update>

    <!-- 주문 상품 정보(주문취소) -->
    <select id="getOrderOneInfo" resultType="com.vam.model.OrderOne">

        SELECT *
          FROM order_one
         WHERE orderid = #{orderId}

    </select>

    <!-- 주문 정보(주문 취소) -->
    <select id="getOrder" resultType="Order">

        SELECT *
          FROM `order`
         WHERE order_number = #{orderId}

    </select>


</mapper>